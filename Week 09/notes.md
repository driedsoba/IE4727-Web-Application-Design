## Sessions

### Cookies
- Preserve state across transactions
- Name-value pairs stored on client side


### How Sessions Work
- User accesses a website, PHP generates a unique session ID
- PHP associates session ID with session data on server
- Session ID is stored in a cookie on user's browser
- When user navigates to another page, PHP checks for session ID cookie and retrieves session data from server


### Setting cookies from PHP
```php
setcookie (string name, string value, int expire, string path, string domain, int secure, httponly);
```
- name: Name of the cookie
- value: Value of the cookie
- expire: Expiration time (Unix timestamp)
- path: Path on the server in which the cookie will be available
- domain: Domain that the cookie is available to
- secure: Indicates if the cookie should only be transmitted over a secure HTTPS connection
- httponly: Indicates if the cookie is accessible only through the HTTP protocol
- eg. path as '/~directory/', domain as '.example.com'

### Using cookies
```php
// Set a cookie
setcookie("username", "JohnDoe", time() + (86400 * 30), "/"); // 86400 = 1 day
```
- once a cookie is set, it can be accessed on subsequent requests using the `$_COOKIE` superglobal array
```php
echo $_COOKIE["username"];
```
- calling setcooke() again with only name will delete the cookie
- if cookie is deleted, user could reenter user and password to recreate cookie
- browser places limit on number and size of cookies per website.
- using sessions is often a better alternative to cookies for storing user data

### Session Control in PHP
- Http is stateless, no way to maintain transactions across different pages
- Cookies not appropriate for storing large amounts of data or sensitive information
- It is a superglobal array that can be used to store information to be used across multiple pages, $_SESSION
- Session ID is generated by PHP and is automatically set in the user's browser as a cookie that contains the session ID
- Stores on client side for the lifetime of a session, session ID acts as a key to register session variables
- Content of variables stored on server side


### Implementing Sessions in PHP
- 1. start a session using session_start() at the beginning of each page that uses sessions
- 2. registering session variables using the $_SESSION superglobal array
- 3. using session variables across multiple pages
- 4. deregistering session variables using unset() or destroying the entire session using session_destroy()
```php
<?php
// Start the session
session_start();
// Register session variable
if (isset($_SESSION['visits'])) {
    $_SESSION['visits'] = $_SESSION['visits'] + 1;
} else {
    $_SESSION['visits'] = 1;
}
# Using session variable
$visits = $_SESSION['visits'];
if ($visits > 1) {
  echo "This is visit number $visits.";
} else {// First visit
  echo 'Welcome to my Web site! Click here for a tour!';
}
# Deregister session variable
session_destroy();
unset($_SESSION['visits']);
?>
```

